var _=Object.defineProperty,B=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var k=(a,t,i)=>t in a?_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,h=(a,t)=>{for(var i in t||(t={}))j.call(t,i)&&k(a,i,t[i]);if(L)for(var i of L(t))G.call(t,i)&&k(a,i,t[i]);return a},I=(a,t)=>B(a,F(t));import{j as u,I as J,a as e,b as K,T as R,c as N,C as O,d as V,e as W,f as Y,s as $,g as q,S as z,B as g,h as X,D as x,L as Q,G as Z,P as ee,i as te,k as ae,l as re,m as ie,n as E,o as se}from"./vendor.89fa43fd.js";const ne=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&d(l)}).observe(document,{childList:!0,subtree:!0});function i(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerpolicy&&(n.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?n.credentials="include":s.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function d(s){if(s.ep)return;s.ep=!0;const n=i(s);fetch(s.href,n)}};ne();const S="a8e98bd0-7d39-4b69-84aa-0798b94b0f5d",D="https://harrisoff.github.io/onedrive-image-hosting",oe="OneDriveImageHosting";function le(a){return a&&a.startsWith("#")?(a=a.slice(1),Object.fromEntries(a.split("&").map(t=>t.split("=")).filter(t=>t.length===2))):{}}const w="oneDriveImageHostingCacheRecords",ce=100,de=()=>JSON.parse(localStorage.getItem(w)||"[]"),me=a=>{localStorage.setItem(w,JSON.stringify(a.slice(-ce)))};var ue=a=>{const{fileName:t,status:i,shareUrl:d,errorMessage:s,onClickUpload:n}=a;let l,m;return s?(l=e("div",{className:"imageListItemContent",children:e("p",{className:"errorMessage",children:s})}),m=e(R,{title:"upload again",children:e(N,{sx:{color:"white"},onClick:()=>n(t),children:e(O,{})})})):i==="uploading"?(l=e("div",{className:"imageListItemContent"}),m=e(N,{sx:{color:"white"},children:e(O,{className:"flicker"})})):(l=e("img",{src:d}),m=e(R,{title:"copy url",children:e(N,{sx:{color:"white"},onClick:()=>{d&&V(d)},children:e(W,{})})})),u(J,{className:"imageListItem",children:[l,e(K,{className:"imageListItemBar",title:e("div",{title:t,children:t}),position:"bottom",actionIcon:m,actionPosition:"left"})]})},fe=({itemList:a,onClickUpload:t})=>e(Y,{cols:5,rowHeight:164,className:"imageList",children:a.map(i=>React.createElement(ue,I(h({},i),{key:i.fileName,onClickUpload:t})))});const he=$("input")({display:"none"}),C=de();var pe=({accessToken:a})=>{const[t]=React.useState(new q({accessToken:a})),i=C[C.length-1],[d,s]=React.useState((i==null?void 0:i.folderName)||oe),[n,l]=React.useState(C.map(r=>I(h({},r),{status:"cache"}))),m=(r,c)=>{l(f=>f.map(o=>o.status!=="cache"&&o.fileName===r.fileName?h(h({},o),c):o))};React.useEffect(()=>{me(n.filter(r=>r.status==="cache"||r.status==="shared").map(r=>({fileName:r.fileName,folderName:r.folderName,shareUrl:r.shareUrl})))},[n]);const v=r=>{m(r,{status:"uploading"}),t.upload(r.data,`${r.folderName}/${r.fileName}`).then(({id:c})=>(m(r,{status:"uploaded",uploadId:c}),new Promise((f,o)=>{t.share(c).then(({shareId:p})=>{m(r,{status:"shared",shareId:p,shareUrl:se(p)})}).catch(o)}))).catch(c=>{m(r,{status:"error",errorMessage:c.message})})},U=r=>{const f=Array.from(r.target.files||[]).map(o=>({fileName:o.name,data:o,folderName:d,uploadId:"",shareId:"",shareUrl:"",status:"pending"})).filter(o=>!n.map(p=>p.fileName).includes(o.fileName));l(o=>[...o,...f]),f.forEach(v)},M=r=>{const c=n.find(f=>f.fileName===r);c&&v(c)},[H,y]=React.useState(!1),P=()=>{y(!0)},T=()=>{location.href=E(S,D)},b=()=>{y(!1)};return u("div",{className:"main",children:[u(z,{direction:"row",alignItems:"center",spacing:2,className:"toolbox",children:[u("label",{children:[e(he,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:U}),e(g,{variant:"contained",component:"span",children:"Select Files"})]}),e(X,{size:"small",label:"folder name",value:d,onChange:r=>s(r.target.value)}),e(x,{orientation:"vertical",flexItem:!0}),e("span",{children:"If access_token is expired:"}),e(g,{variant:"contained",component:"span",onClick:P,children:"Open Auth Url"}),e(x,{orientation:"vertical",flexItem:!0}),e(Q,{href:"https://github.com/harrisoff/onedrive-image-hosting",target:"_blank",children:e(Z,{})})]}),e(ee,{elevation:2,className:"imageListWrapper",children:n.length>0?e(fe,{itemList:n,onClickUpload:M}):"Selected files will be displayed here"}),u(te,{open:H,onClose:b,children:[e(ae,{children:e(re,{children:"You are leaving this page."})}),u(ie,{children:[e(g,{color:"primary",onClick:T,children:"Go ahead"}),e(g,{color:"primary",onClick:b,children:"Cancel"})]})]})]})};const A=({label:a,message:t})=>u("p",{children:[u("span",{style:{color:"red",marginRight:"10px"},children:[a,":"]}),t]});function ge(){const{access_token:a,error:t,error_description:i}=le(location.hash);return a?e(pe,{accessToken:a}):t?u("div",{style:{margin:"20px"},children:[e(A,{label:"ERROR",message:t}),e(A,{label:"ERROR DESCRIPTION",message:i.replace(/\+/g," ")})]}):(location.href=E(S,D),e("div",{style:{margin:"20px"},children:"Redirecting to OneDrive authentication page, please wait..."}))}ReactDOM.render(e(React.StrictMode,{children:e(ge,{})}),document.getElementById("root"));
