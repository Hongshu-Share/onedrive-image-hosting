var _=Object.defineProperty,B=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var L=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,G=Object.prototype.propertyIsEnumerable;var k=(a,t,r)=>t in a?_(a,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[t]=r,h=(a,t)=>{for(var r in t||(t={}))j.call(t,r)&&k(a,r,t[r]);if(L)for(var r of L(t))G.call(t,r)&&k(a,r,t[r]);return a},I=(a,t)=>B(a,F(t));import{j as f,I as J,a as e,b as K,T as R,c as N,C as O,d as V,e as W,f as Y,s as $,g as q,S as z,B as g,h as X,D as x,L as Q,G as Z,P as ee,i as te,k as ae,l as re,m as ie,n as S,o as se}from"./vendor.89fa43fd.js";const ne=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))m(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const c of s.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&m(c)}).observe(document,{childList:!0,subtree:!0});function r(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function m(i){if(i.ep)return;i.ep=!0;const s=r(i);fetch(i.href,s)}};ne();const D="a8e98bd0-7d39-4b69-84aa-0798b94b0f5d",E="https://harrisoff.github.io/onedrive-image-hosting",oe="OneDriveImageHosting";function le(a){return a&&a.startsWith("#")?(a=a.slice(1),Object.fromEntries(a.split("&").map(t=>t.split("=")).filter(t=>t.length===2))):{}}const w="oneDriveImageHostingCacheRecords",ce=100,de=()=>JSON.parse(localStorage.getItem(w)||"[]"),me=a=>{localStorage.setItem(w,JSON.stringify(a.slice(-ce)))};var ue=a=>{const{fileName:t,status:r,shareUrl:m,errorMessage:i,onClickUpload:s}=a;let c,u;return i?(c=e("div",{className:"imageListItemContent",children:e("p",{className:"errorMessage",children:i})}),u=e(R,{title:"upload again",children:e(N,{sx:{color:"white"},onClick:()=>s(t),children:e(O,{})})})):r==="uploading"?(c=e("div",{className:"imageListItemContent"}),u=e(N,{sx:{color:"white"},children:e(O,{className:"flicker"})})):(c=e("img",{src:m}),u=e(R,{title:"copy url",children:e(N,{sx:{color:"white"},onClick:()=>{m&&V(m)},children:e(W,{})})})),f(J,{className:"imageListItem",children:[c,e(K,{className:"imageListItemBar",title:e("div",{title:t,children:t}),position:"bottom",actionIcon:u,actionPosition:"left"})]})},fe=({itemList:a,onClickUpload:t})=>e(Y,{cols:5,rowHeight:164,className:"imageList",children:a.map(r=>React.createElement(ue,I(h({},r),{key:r.fileName,onClickUpload:t})))});const he=$("input")({display:"none"}),C=de();var pe=({accessToken:a})=>{const[t]=React.useState(new q({accessToken:a})),r=C[C.length-1],[m,i]=React.useState((r==null?void 0:r.folderName)||oe),[s,c]=React.useState(C.map(n=>I(h({},n),{status:"cache"}))),u=(n,d)=>{c(o=>o.map(l=>l.status!=="cache"&&l.fileName===n.fileName?h(h({},l),d):l)),d.status==="shared"&&me(s.filter(o=>o.status==="cache"||o.status==="shared").map(o=>({fileName:o.fileName,folderName:o.folderName,shareUrl:o.shareUrl})))},v=n=>{u(n,{status:"uploading"}),t.upload(n.data,`${n.folderName}/${n.fileName}`).then(({id:d})=>(u(n,{status:"uploaded",uploadId:d}),new Promise((o,l)=>{t.share(d).then(({shareId:p})=>{u(n,{status:"shared",shareId:p,shareUrl:se(p)})}).catch(l)}))).catch(d=>{u(n,{status:"error",errorMessage:d.message})})},U=n=>{const o=Array.from(n.target.files||[]).map(l=>({fileName:l.name,data:l,folderName:m,uploadId:"",shareId:"",shareUrl:"",status:"pending"})).filter(l=>!s.map(p=>p.fileName).includes(l.fileName));c(l=>[...l,...o]),o.forEach(v)},M=n=>{const d=s.find(o=>o.fileName===n);d&&v(d)},[H,y]=React.useState(!1),P=()=>{y(!0)},T=()=>{location.href=S(D,E)},b=()=>{y(!1)};return f("div",{className:"main",children:[f(z,{direction:"row",alignItems:"center",spacing:2,className:"toolbox",children:[f("label",{children:[e(he,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:U}),e(g,{variant:"contained",component:"span",children:"Select Files"})]}),e(X,{size:"small",label:"folder name",value:m,onChange:n=>i(n.target.value)}),e(x,{orientation:"vertical",flexItem:!0}),e("span",{children:"If access_token is expired:"}),e(g,{variant:"contained",component:"span",onClick:P,children:"Open Auth Url"}),e(x,{orientation:"vertical",flexItem:!0}),e(Q,{href:"https://github.com/harrisoff/onedrive-image-hosting",target:"_blank",children:e(Z,{})})]}),e(ee,{elevation:2,className:"imageListWrapper",children:s.length>0?e(fe,{itemList:s,onClickUpload:M}):"Selected files will be displayed here"}),f(te,{open:H,onClose:b,children:[e(ae,{children:e(re,{children:"You are leaving this page."})}),f(ie,{children:[e(g,{color:"primary",onClick:T,children:"Go ahead"}),e(g,{color:"primary",onClick:b,children:"Cancel"})]})]})]})};const A=({label:a,message:t})=>f("p",{children:[f("span",{style:{color:"red",marginRight:"10px"},children:[a,":"]}),t]});function ge(){const{access_token:a,error:t,error_description:r}=le(location.hash);return a?e(pe,{accessToken:a}):t?f("div",{style:{margin:"20px"},children:[e(A,{label:"ERROR",message:t}),e(A,{label:"ERROR DESCRIPTION",message:r.replace(/\+/g," ")})]}):(location.href=S(D,E),e("div",{style:{margin:"20px"},children:"Redirecting to OneDrive authentication page, please wait..."}))}ReactDOM.render(e(React.StrictMode,{children:e(ge,{})}),document.getElementById("root"));
